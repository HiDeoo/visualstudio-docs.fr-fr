---
title: 'CA5381 : S’assurer que les certificats ne sont pas ajoutés au magasin racine'
description: Fournit des informations sur la règle d’analyse du code CA5381, notamment les causes, comment corriger les violations et quand la supprimer.
ms.date: 08/14/2019
ms.topic: reference
author: filipsebesta
ms.author: filipse
manager: jillfra
dev_langs:
- CSharp
ms.workload:
- multiple
f1_keywords:
- CA5381
- DoNotInstallRootCert
ms.openlocfilehash: f59c01684e0cfce3057c00574b9d550712d40f41
ms.sourcegitcommit: 577c905de52057a741e68c2ed168ea527813fda5
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/15/2020
ms.locfileid: "88250332"
---
# <a name="ca5381-ensure-certificates-are-not-added-to-root-store"></a>CA5381 : S’assurer que les certificats ne sont pas ajoutés au magasin racine

|Élément|Valeur|
|-|-|
|CheckId|CA5381|
|Category|Microsoft.Security|
|Modification avec rupture|Sans rupture|

## <a name="cause"></a>Cause

L’ajout de certificats aux certificats racines approuvés du système d’exploitation augmente le risque d’une autorité de certification non approuvée legitimizing.

Par défaut, cette règle analyse l’ensemble du code base, mais il peut être [configuré](#configurability).

## <a name="rule-description"></a>Description de la règle

Cette règle détecte le code qui ajoute potentiellement un certificat dans le magasin de certificats des autorités de certification racines de confiance. Par défaut, le magasin de certificats des autorités de certification racines de confiance est configuré avec un ensemble d’autorités de certification publiques qui répondent aux exigences du programme de certification racine de Microsoft. Dans la mesure où toutes les autorités de certification racines de confiance peuvent émettre des certificats pour n’importe quel domaine, une personne malveillante peut choisir une autorité de certification faible ou contrainte que vous installez par vous-même pour la cible d’une attaque, et une autorité de certification malveillante ou malveillante unique présente la sécurité de l’ensemble du système.

## <a name="how-to-fix-violations"></a>Comment corriger les violations

N’installez pas de certificats dans le magasin de certificats des autorités de certification racines de confiance.

## <a name="when-to-suppress-warnings"></a>Quand supprimer les avertissements

Il n’est pas recommandé de supprimer cette règle.

## <a name="configurability"></a>Configurabilité

Si vous exécutez cette règle à partir d' [analyseurs FxCop](install-fxcop-analyzers.md) (et non avec l’analyse héritée), cette règle est configurable.

### <a name="excluded-symbol-names"></a>Noms de symboles exclus

Vous pouvez configurer les parties de votre code base à exclure de l’analyse. Par exemple, pour spécifier que la règle ne doit pas être exécutée sur un code dans des types nommés `MyType` , ajoutez la paire clé-valeur suivante à un fichier. editorconfig dans votre projet :

```ini
dotnet_code_quality.CA5381.excluded_symbol_names = MyType
```

Formats de noms de symboles autorisés dans la valeur de l’option (séparés par' | ') :
- Nom de symbole uniquement (comprend tous les symboles portant le nom, quel que soit le type ou l’espace de noms conteneur)
- Noms qualifiés complets dans le format d' [ID de documentation](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)du symbole. Chaque nom de symbole requiert un préfixe de type de symbole, tel que le préfixe « M : » pour les méthodes, le préfixe « T : » pour les types, le préfixe « N : » pour les espaces de noms, etc.
- `.ctor` pour les constructeurs et `.cctor` les constructeurs statiques

Exemples :

| Valeur d’option | Récapitulatif |
| --- | --- |
|`dotnet_code_quality.CA5381.excluded_symbol_names = MyType` | Correspond à tous les symboles nommés’MyType’dans la compilation
|`dotnet_code_quality.CA5381.excluded_symbol_names = MyType1|MyType2` | Correspond à tous les symboles nommés’MyType1 'ou’MyType2 'dans la compilation
|`dotnet_code_quality.CA5381.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Correspond à la méthode spécifique’MyMethod’avec la signature complète donnée
|`dotnet_code_quality.CA5381.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Met en correspondance des méthodes spécifiques « MyMethod1 » et « MyMethod2 » avec la signature complète respective

Vous pouvez configurer toutes ces options uniquement pour cette règle, pour toutes les règles ou pour toutes les règles de cette catégorie (sécurité). Pour plus d’informations, consultez [configurer les analyseurs FxCop](configure-fxcop-analyzers.md).

## <a name="pseudo-code-examples"></a>Exemples de pseudo-code

### <a name="violation"></a>Violation

L’exemple de pseudo-code suivant illustre le modèle détecté par cette règle.

```csharp
using System;
using System.Security.Cryptography.X509Certificates;

class TestClass
{
    public void TestMethod()
    {
        var storeName = StoreName.Root;
        Random r = new Random();

        if (r.Next(6) == 4)
        {
            storeName = StoreName.My;
        }

        var x509Store = new X509Store(storeName);
        x509Store.Add(new X509Certificate2());
    }
}
```

### <a name="solution"></a>Solution

```csharp
using System.Security.Cryptography.X509Certificates;

class TestClass
{
    public void TestMethod()
    {
        var storeName = StoreName.My;
        var x509Store = new X509Store(storeName);
        x509Store.Add(new X509Certificate2());
    }
}
```
